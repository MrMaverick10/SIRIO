<div ng-controller="instituteListPageController">
  <div ng-if="!EditingOn">
    <div>
      <h2 style="margin-right:50px;">ISTITUTI</h2>
      <md-button class="md-raised md-accent" style="float:right;font-weight:bold;" ng-click="NuovoIstituto()">INSERISCI NUOVO ISTITUTO</md-button>      
      <div layout="row">
        <md-input-container class="containerSelect" style="width:20%;margin-right:10px;"><label>Filtra per provincia...</label>
          <md-select ng-model="ProvinciaFiltro" placeholder="PROVINCIA" class="mdb-select" type="text" name="ProvinciaFiltro" aria-label="Provincia">
          <md-optgroup>
            <md-option ng-value="-1">QUALSIASI</md-option>  
            <md-option ng-repeat="provincia in ListaProvince" ng-value="provincia.Chiave">{{provincia.Nome}}</md-option>
          </md-optgroup>
          </md-select>
        </md-input-container>
        <md-input-container class="containerSelect" style="width:20%;"><label>Filtra per nome...</label>
          <input ng-model="NomeFiltro" type="search">
        </md-input-container>
      </div>
    </div>
    <div ng-if="ListaIstituti.length != 0">
      <table style="width:100%;text-align:center;" md-row-select="GridOptions.rowSelection" multiple="{{GridOptions.multiSelect}}">  
        <tr>
          <th></th>
          <th></th> 
          <th>CODICE</th>  
          <th>NOME</th>
          <th>PROVINCIA</th> 
          <th>PROMOTORE ASSEGNATO</th>      
        </tr>  
        <tr ng-repeat="Istituto in ListaIstituti | IstitutoByFiltro : ProvinciaFiltro : NomeFiltro | limitTo : GridOptions.query.limit : (GridOptions.query.page - 1) * GridOptions.query.limit" id={{Istituto.Chiave}}>
          <td><img src="img/delete.png" style="width:20px;height:auto;" ng-click="EliminaIstituto(Istituto)"></td> 
          <td><img src="img/edit.png" style="width:20px;height:auto;" ng-click="ModificaIstituto(Istituto)"></td>        
          <td class="off">{{Istituto.Codice}}</td>  
          <td class="off">{{Istituto.Nome}}</td>
          <td class="off">{{Istituto.ProvinciaNome}}</td>
          <td class="off">{{Istituto.Promotore || 'NESSUN PROMOTORE ASSEGNATO'}}</td>        
        </tr>    
      </table>
      <md-table-pagination md-limit="GridOptions.query.limit" 
                           md-limit-options="GridOptions.limitOptions" 
                           md-page="GridOptions.query.page" 
                           md-total="{{ListaIstituti.length}}" 
                           md-page-select="GridOptions.pageSelect" 
                           md-boundary-links="GridOptions.boundaryLinks" 
                           md-on-paginate="logPagination"></md-table-pagination>
    </div>
    <p ng-if="ListaIstituti.length == 0" style="font-weight:bold;font-style:italic;">NESSUN ISTITUTO PRESENTE</p>
  </div>
                         
  <div ng-if="EditingOn">
  <form name="istitutoEditForm" layout="column" style="width:100%" ng-submit="ConfermaIstituto()" novalidate>
       <div layout="row">
         <h2 ng-if="IstitutoInEditing.Chiave != -1">MODIFICA ISTITUTO</h2>
         <h2 ng-if="IstitutoInEditing.Chiave == -1">CREAZIONE NUOVO ISTITUTO</h2>
         <div layout="row" style="width:100%;" layout-align="end start">
           <md-button class="md-raised md-accent" style="font-weight:bold;" type="submit" ng-disabled="istitutoEditForm.$invalid">CONFERMA</md-button>
           <md-button class="md-raised md-accent" style="font-weight:bold;" ng-click="OnAnnullaIstitutoClicked()">ANNULLA</md-button>
         </div>
       </div>
       
       <md-tabs style="width:100%;" md-selected="selectedIstitutiClassi" md-border-bottom md-autoselect md-dynamic-height md-swipe-content>
           <md-tab label="Generale">
           <br>
           <br>
             <div layout="row">
               <md-input-container flex=40>
                 <label>CODICE</label><input ng-model="IstitutoInEditing.Codice" type="text" name="Codice" required>
                 <div ng-messages="istitutoEditForm.Codice.$error" multiple md-auto-hide="true">
                   <div ng-message="required">Inserire il codice dell'istituto</div>
                 </div>
               </md-input-container>                                       
               <md-input-container class="containerSelect" flex=40>             
                 <label>TIPOLOGIA</label>
                 <md-select ng-model="IstitutoInEditing.Tipologia" class="mdb-select" type="text" name="Tipologia" aria-label="Tipologia">
                 <md-optgroup>
                   <md-option ng-value="-1">-</md-option>  
                   <md-option ng-repeat="tipologia in ListaTipologie" ng-value="tipologia.Chiave">{{tipologia.Descrizione}}</md-option>         
                 </md-optgroup>
                 </md-select>
               </md-input-container>
             </div>             

             <div layout="row">
               <md-input-container flex="100">
                 <label>NOME</label><input ng-model="IstitutoInEditing.Nome" type="text" name="Nome" required>
                 <div ng-messages="istitutoEditForm.Nome.$error" multiple md-auto-hide="true">
                   <div ng-message="required">Inserire il nome dell'istituto</div>
                 </div>
               </md-input-container> 
             </div>
             
             <div layout="row">
               <md-input-container style="width:20%;">
                 <label>INDIRIZZO</label><input ng-model="IstitutoInEditing.Indirizzo" type="text" name="Indirizzo" required>
                 <div ng-messages="istitutoEditForm.Indirizzo.$error" multiple md-auto-hide="true">
                   <div ng-message="required">Inserire l'indirizzo dell'istituto</div>
                 </div>
               </md-input-container>
               <md-input-container style="width:20%;">
                 <label>COMUNE</label><input ng-model="IstitutoInEditing.Comune" type="text" name="Comune" required>
                 <div ng-messages="istitutoEditForm.Comune.$error" multiple md-auto-hide="true">
                   <div ng-message="required">Inserire il comune dell'istituto</div>
                 </div>
               </md-input-container>             
               <md-input-container class="containerSelect" style="width:20%;">
                 <md-select ng-model="IstitutoInEditing.Provincia" placeholder="PROVINCIA" class="mdb-select" type="text" name="Provincia" aria-label="Provincia" required>
                 <md-optgroup>
                   <!--<md-option ng-value="-1">-</md-option>-->  
                   <md-option ng-repeat="provincia in ListaProvince" ng-value="provincia.Chiave">{{provincia.Nome}}</md-option>
                 </md-optgroup>
                 </md-select>
                 <div ng-messages="istitutoEditForm.Provincia.$error" multiple md-auto-hide="true">
                   <div ng-message="required">Inserire la provincia dell'istituto</div>
                 </div>
               </md-input-container>
               <md-input-container style="width:5%;">
                 <label>CAP</label><input ng-model="IstitutoInEditing.Cap" type="text" name="Cap" required>
                 <div ng-messages="istitutoEditForm.Cap.$error" multiple md-auto-hide="true">
                   <div ng-message="required">Inserire il CAP dell'istituto</div>
                 </div>
               </md-input-container>  
             </div>
                         
             <div layout="row">
               <md-input-container style="width:20%;">
                 <label>EMAIL</label><input ng-model="IstitutoInEditing.Email" type="text" name="Email">
               </md-input-container>
               <md-input-container style="width:20%;">
                 <label>PEC</label><input ng-model="IstitutoInEditing.Pec" type="text" name="Pec">
               </md-input-container>
               <md-input-container style="width:20%;">
                 <label>SITO WEB</label><input ng-model="IstitutoInEditing.SitoWeb" type="text" name="SitoWeb">
               </md-input-container>
             </div>

             <md-input-container class="containerSelect">             
             <md-radio-group ng-model="IstitutoInEditing.SedeSuccursale" name="SedeSuccursale" required aria-label="SedeOSuccursale">
               <md-radio-button ng-value="1" class="md-primary">SEDE</md-radio-button>
               <md-radio-button ng-value="0"> SUCCURSALE </md-radio-button>
             </md-radio-group>
             </md-input-container>
            
             <div layout="row">
               <md-input-container style="width:20%;">
                 <label>PRIMO REFERENTE</label><input ng-model="IstitutoInEditing.Referente_1" type="text" name="Referente_1">
               </md-input-container>
               <md-input-container style="width:20%;">
                 <label>PRIMO RECAPITO TELEFONICO</label><input ng-model="IstitutoInEditing.NumeroTelefono_1" type="text" name="NumeroTelefono_1">
               </md-input-container>
             </div>
             
             <div layout="row">
               <md-input-container style="width:20%;">             
                 <label>SECONDO REFERENTE</label><input ng-model="IstitutoInEditing.Referente_2" type="text" name="Referente_2">
               </md-input-container>
               <md-input-container style="width:20%;">
                 <label>SECONDO RECAPITO TELEFONICO</label><input ng-model="IstitutoInEditing.NumeroTelefono_2" type="text" name="NumeroTelefono_2">
               </md-input-container>
             </div>
             
             <div layout="row">
               <md-input-container style="width:20%;">
                 <label>TERZO REFERENTE</label><input ng-model="IstitutoInEditing.Referente_3" type="text" name="Referente_3">
               </md-input-container>
               <md-input-container style="width:20%;">
                 <label>TERZO RECAPITO TELEFONICO</label><input ng-model="IstitutoInEditing.NumeroTelefono_3" type="text" name="NumeroTelefono_3">
               </md-input-container>
             </div>
             
             <md-input-container class="containerSelect" style="width:20%;">             
               <label>PROMOTORE ASSEGNATO</label>
               <md-select ng-model="IstitutoInEditing.PromotoreAssegnato" class="mdb-select" type="text" name="PromotoreAssegnato" aria-label="Promotore assegnato">
               <md-optgroup label="-">
                 <md-option ng-value="-1">Nessun promotore assegnato</md-option>  
                 <md-option ng-repeat="promotore in ListaPromotori" ng-value="promotore.Chiave">{{promotore.RagioneSociale}}</md-option>         
               </md-optgroup>
               </md-select>
             </md-input-container>
           </md-tab>
          
           <md-tab label="Classi">
             <br>
             <label style="display:inline-block;">VISUALIZZA FINO ALLA SEZIONE:</label> 
             <md-input-container class="containerSelect" style="width:3%;">                           
               <md-select ng-model="SezioneMax" ng-change="CreaListaSelezione(SezioneMax)" class="mdb-select" style="display:inline-block;width:3%;" type="text" name="SezioneMax">
               <md-optgroup label="-"> 
                 <md-option ng-repeat="lettera in ListaSezioni" ng-value="$index">{{lettera}}</md-option>         
               </md-optgroup>
               </md-select>
             </md-input-container>
             
             <br>
             <table table style="width:100%;text-align:center;" md-row-select="GridOptions.rowSelection" multiple="{{GridOptions.multiSelect}}">
               <thead>
                 <tr>
                  <td style="width:10%;font-weight:bold;">SEZIONE</td>
                  <td ng-repeat="annoHead in Anno" style="width:10%;font-weight:bold;">{{annoHead}}</td>
                 <tr>
               </thead>
               <tbody>
                 <tr ng-repeat="lettera in ListaSezioniFinale">
                   <td>{{lettera}}</td>
                   <td ng-repeat="annoData in Anno"><input type="checkbox" ng-model="ClasseCliccata[lettera + annoData]" ng-change="ModificaListaClassi(lettera,annoData)"/></td>
                 </tr>
               </tbody>
             </table>           
          </md-tab>
       </md-tabs>
     
  </form>        
  </div> 
</div> 