{ 
  "SelectSQL"    : [
                     { 
                       "Name" : "InstituteInfoList",
                       "SQL"  : "SELECT istituti.CHIAVE,istituti.NASCOSTO,istituti.CODICE,istituti.NOME,(SELECT COUNT(*) FROM istituti_x_docenti WHERE ISTITUTO = istituti.CHIAVE) AS NR_DOCENTI,istituti.PROVINCIA,province.NOME AS NOME_PROVINCIA,utenti.USERNAME AS PROMOTORE FROM province,istituti LEFT OUTER JOIN utenti ON (utenti.CHIAVE = istituti.PROMOTORE) WHERE province.CHIAVE = istituti.PROVINCIA ORDER BY istituti.NOME"
                     }                       
                   ],
 
 "SelectSQLOnlyVisible"    : [
                               { 
                                 "Name" : "InstituteInfoListOnlyVisibile",
                                 "SQL"  : "SELECT istituti.CHIAVE,istituti.CODICE,istituti.NOME,istituti.PROVINCIA FROM istituti WHERE NASCOSTO <> 1 ORDER BY istituti.NOME"
                               }                       
                             ],
                   
  "SelectInstituteDelivery"    : [
                                   { 
                                     "Name" : "InstituteForDeliveryList",
                                     "SQL"  : "SELECT istituti.CHIAVE,istituti.NOME,istituti.INDIRIZZO,istituti.COMUNE,istituti.CAP,istituti.PROVINCIA,(SELECT province_all.CHIAVE FROM province_all WHERE NOME=(SELECT province.NOME FROM province WHERE CHIAVE = istituti.PROVINCIA)) AS PROVINCIA_LISTA_ALL FROM istituti WHERE NASCOSTO <> 1 ORDER BY istituti.NOME"
                                   }                       
                                 ],

  "SelectInstituteTeacherList" : [
                                   {
                                     "Name" : "InstituteTeacherList",
                                     "SQL"  : "SELECT istituti_x_docenti.DOCENTE,(SELECT docenti.RAGIONE_SOCIALE FROM docenti WHERE CHIAVE = istituti_x_docenti.DOCENTE) AS NOME_DOCENTE FROM istituti_x_docenti WHERE istituti_x_docenti.ISTITUTO=:CHIAVE ORDER BY NOME_DOCENTE"
                                   },
                                   {
                                     "Name" : "InstituteTeacherAvailability",
                                     "SQL"  : "SELECT docenti_disponibilita.* FROM docenti_disponibilita WHERE ISTITUTO=:CHIAVE ORDER BY DOCENTE,POSIZIONE ASC,GIORNO ASC,DA DESC,A DESC"
                                   }
                                 ],                           
                   
  "SQLDettaglio" : [
                     { 
                       "Name" : "InstituteDettaglio",
                       "SQL"  : "SELECT * FROM istituti WHERE CHIAVE=:CHIAVE"
                     },
                     {
                       "Name" : "ClassiInstitute",
                       "SQL"  : "SELECT *,(SELECT DESCRIZIONE FROM classi_combinazioni WHERE CHIAVE = classi.COMBINAZIONE) AS COMBINAZIONE_DESCR FROM classi WHERE ISTITUTO=:CHIAVE ORDER BY classi.COMBINAZIONE,classi.SEZIONE,classi.ANNO"
                     },
                     {
                      "Name" : "GetAdoptionListInstitute",
                      "SQL"  : "SELECT adozioni_titolo.TITOLO,adozioni_titolo.CHIAVE,adozioni_titolo.CLASSE,(SELECT titoli.TITOLO FROM titoli WHERE CHIAVE = adozioni_titolo.TITOLO) AS NOME_TITOLO,(SELECT titoli.CODICE_ISBN FROM titoli WHERE CHIAVE = adozioni_titolo.TITOLO) AS CODICE_TITOLO,(SELECT ANNO FROM classi WHERE CHIAVE = adozioni_titolo.CLASSE) AS ANNO_CLASSE,(SELECT SEZIONE FROM classi WHERE CHIAVE = adozioni_titolo.CLASSE) AS SEZIONE_CLASSE,(SELECT DESCRIZIONE FROM classi_combinazioni WHERE CHIAVE IN (SELECT COMBINAZIONE FROM classi WHERE CHIAVE = adozioni_titolo.CLASSE)) AS COMBINAZIONE_CLASSE FROM adozioni_titolo WHERE CLASSE IN (SELECT CHIAVE FROM classi WHERE ISTITUTO = #CHIAVE) ORDER BY CLASSE,COMBINAZIONE_CLASSE,SEZIONE_CLASSE,ANNO_CLASSE,NOME_TITOLO"
                     }
                   ],
  
  "GetAdozioniClasse" : [
                          {
                            "Name" : "GetAdoptionClass",
                            "SQL"  : "SELECT COUNT(*) AS COUNT_ADOZIONI FROM adozioni_titolo WHERE CLASSE IN (SELECT CHIAVE FROM classi WHERE ISTITUTO = :Istituto AND ANNO = :Anno AND SEZIONE = #Sezione AND COMBINAZIONE = :Combinazione)"
                          }
                        ],

  "EditSQL"      : [   
                     {
                       "Name" : "InsertInstitute",
                       "SQL"  : "INSERT INTO istituti (CHIAVE,CODICE,NOME,TIPOLOGIA,INDIRIZZO,COMUNE,PROVINCIA,CAP,EMAIL,PEC,SITO_WEB,SEDE,REFERENTE_1,TELEFONO_1,REFERENTE_2,TELEFONO_2,REFERENTE_3,TELEFONO_3,PROMOTORE,PRESIDE,VICEPRESIDE,DIR_AMMNSTR) VALUES(:NewKey1,#CODICE,#NOME,:TIPOLOGIA,#INDIRIZZO,#COMUNE,:PROVINCIA,#CAP,#EMAIL,#PEC,#SITO_WEB,:SEDE,#REFERENTE_1,#TELEFONO_1,#REFERENTE_2,#TELEFONO_2,#REFERENTE_3,#TELEFONO_3,:PROMOTORE,#PRESIDE,#VICEPRESIDE,#DIR_AMMNSTR)"
                     },
                     {
                       "Name" : "InsertClass",
                       "SQL"  : "INSERT INTO classi (CHIAVE,ANNO,SEZIONE,ISTITUTO,COMBINAZIONE) VALUES (:NewKey1,#ANNO,#SEZIONE,:ISTITUTO,:COMBINAZIONE)"
                     }, 
                     {
                       "Name" : "InsertClassAfterInsert",
                       "SQL"  : "INSERT INTO classi (CHIAVE,ANNO,SEZIONE,ISTITUTO,COMBINAZIONE) VALUES (:NewKey2,#ANNO,#SEZIONE,:NewKey1,:COMBINAZIONE)"
                     },                     
                     {
                       "Name" : "UpdateInstitute",
                       "SQL"  : "UPDATE istituti SET CODICE=#CODICE,NOME=#NOME,TIPOLOGIA=:TIPOLOGIA,PROVINCIA=:PROVINCIA,COMUNE=#COMUNE,INDIRIZZO=#INDIRIZZO,CAP=#CAP,EMAIL=#EMAIL,PEC=#PEC,SITO_WEB=#SITO_WEB,SEDE=:SEDE,TELEFONO_1=#TELEFONO_1,REFERENTE_1=#REFERENTE_1,TELEFONO_2=#TELEFONO_2,REFERENTE_2=#REFERENTE_2,TELEFONO_3=#TELEFONO_3,REFERENTE_3=#REFERENTE_3,PROMOTORE=:PROMOTORE,PRESIDE=#PRESIDE,VICEPRESIDE=#VICEPRESIDE,DIR_AMMNSTR=#DIR_AMMNSTR WHERE CHIAVE=:CHIAVE"
                     },
                     {
                       "Name" : "DeleteInstitute",
                       "SQL"  : "DELETE FROM istituti WHERE CHIAVE=:CHIAVE"
                     },
                     {
                       "Name" : "DeleteClass",
                       "SQL"  : "DELETE FROM classi WHERE ISTITUTO=:ISTITUTO AND SEZIONE = #SEZIONE AND ANNO = :ANNO AND COMBINAZIONE =:COMBINAZIONE"
                     },
                     {
                       "Name" : "DeleteAdoption",
                       "SQL"  : "DELETE FROM adozioni_titolo WHERE CLASSE IN (SELECT CHIAVE FROM classi WHERE ISTITUTO=:ISTITUTO AND SEZIONE=#SEZIONE AND ANNO=:ANNO AND COMBINAZIONE=:COMBINAZIONE)"
                     },
                     {
                       "Name" : "UpdateDatabaseInstitute",
                       "SQL"  : "CALL AGGIORNA_ISTITUTO(#CodiceIstituto,#NomeIstituto,#IndirizzoIstituto,:ProvinciaIstituto,#ComuneIstituto,#CapIstituto,#EmailIstituto,#PecIstituto,#SitoWebIstituto,:SedeIstituto,#TipologiaIstituto)"
                     },
                     {
                       "Name" : "SetInstituteVisibility",
                       "SQL"  : "UPDATE istituti SET NASCOSTO=0 WHERE CHIAVE=:CHIAVE"
                     },
                     {
                       "Name" : "TransferTeacherToInstitute",
                       "SQL"  : "UPDATE istituti_x_docenti SET ISTITUTO=:NUOVO_ISTITUTO WHERE ISTITUTO=:VECCHIO_ISTITUTO"
                     },
                     {
                       "Name" : "MergeInstitute",
                       "SQL"  : "CALL UNISCI_NASCONDI_ISTITUTI(:OldIstituto,:NewIstituto)"
                     }
                   ]        
}
